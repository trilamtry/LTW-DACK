@model FashionStore.Models.Order
@{
    ViewBag.Title = "Chi tiết đơn hàng";
    Layout = "~/Areas/Admin/Views/Shared/_LayoutAdmin.cshtml";
    var cultureInfo = new System.Globalization.CultureInfo("vi-VN");
}

<div class="main-content flex-grow-1 p-3 p-md-4">

    @if (TempData["Message"] != null)
    {
        <div class="alert alert-success">@TempData["Message"]</div>
    }

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3 mb-0">Chi tiết đơn hàng: #@Model.OrderCode</h1>
        <a href="@Url.Action("Index")" class="btn btn-secondary"><i class="bi bi-arrow-left"></i> Quay lại</a>
    </div>

    <div class="row">
        <div class="col-lg-8">
            <div class="card shadow mb-4">
                <div class="card-header bg-white py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Danh sách sản phẩm</h6>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table">
                            <thead class="table-light">
                                <tr>
                                    <th>Sản phẩm</th>
                                    <th>Phân loại</th>
                                    <th class="text-center">SL</th>
                                    <th class="text-end">Đơn giá</th>
                                    <th class="text-end">Thành tiền</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in Model.OrderItems)
                                {
                                    <tr>
                                        <td>@item.ProductName</td>
                                        <td>
                                            <span class="badge bg-light text-dark border">@item.SizeName</span>
                                            <span class="badge bg-light text-dark border">@item.ColorName</span>
                                        </td>
                                        <td class="text-center">@item.Quantity</td>
                                        <td class="text-end">@item.UnitPrice.ToString("N0", cultureInfo)</td>
                                        <td class="text-end fw-bold">
                                            @((item.Quantity * item.UnitPrice).ToString("N0", cultureInfo))
                                        </td>
                                    </tr>
                                }
                            </tbody>
                            <tfoot>
                                <tr class="table-light">
                                    <td colspan="4" class="text-end fw-bold">Tổng cộng:</td>
                                    <td class="text-end fw-bold text-danger fs-5">
                                        @Model.TotalAmount.ToString("N0", cultureInfo) đ
                                    </td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card shadow mb-4">
                <div class="card-header bg-white py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Thông tin giao hàng</h6>
                </div>
                <div class="card-body">
                    <p><strong>Người nhận:</strong> @Model.CustomerName</p>
                    <p><strong>Số điện thoại:</strong> @Model.Phone</p>
                    <p><strong>Địa chỉ:</strong> @Model.AddressLine</p>
                    <p><strong>Ghi chú:</strong> <em class="text-muted">@(string.IsNullOrEmpty(Model.MessageCard) ? "Không có" : Model.MessageCard)</em></p>
                    <p><strong>Ngày đặt:</strong> @Model.CreatedAt.ToString("dd/MM/yyyy HH:mm")</p>
                </div>
            </div>

            <div class="card shadow mb-4">
                <div class="card-header bg-white py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Xử lý đơn hàng</h6>
                </div>
                <div class="card-body">
                    <p>
                        Trạng thái hiện tại:
                        @switch (Model.Status)
                        {
                            case "PENDING":<span class="badge bg-warning text-dark">Chờ xử lý</span>; break;
                            case "SHIPPING": <span class="badge bg-info">Đang giao hàng</span>; break;
                            case "COMPLETED": <span class="badge bg-success">Hoàn thành</span>; break;
                            case "CANCELLED": <span class="badge bg-danger">Đã hủy</span>; break;
                        }
                    </p>

                    @using (Html.BeginForm("UpdateStatus", "Order", FormMethod.Post))
                    {
                        @Html.AntiForgeryToken()
                        @Html.Hidden("id", Model.OrderId)

                        <div class="mb-3">
                            <label class="form-label">Cập nhật trạng thái:</label>
                            <select name="status" class="form-select">
                                <option value="PENDING" @(Model.Status == "PENDING" ? "selected" : "")>Chờ xử lý</option>
                                <option value="SHIPPING" @(Model.Status == "SHIPPING" ? "selected" : "")>Đang giao hàng</option>
                                <option value="COMPLETED" @(Model.Status == "COMPLETED" ? "selected" : "")>Hoàn thành</option>
                                <option value="CANCELLED" @(Model.Status == "CANCELLED" ? "selected" : "")>Hủy đơn</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">Cập nhật</button>
                    }
                </div>
            </div>
        </div>
    </div>
</div>